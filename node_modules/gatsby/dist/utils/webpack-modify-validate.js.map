{"version":3,"sources":["../../src/utils/webpack-modify-validate.js"],"names":["validationWhitelist","object","stylus","any","config","stage","isObject","isFunction","resolve","validationState","returnValidation","schemaExtension","error","console","log","details","forEach","err","index","path","type","message","process","exit","ValidateWebpackConfig"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMA,sBAAsB,sBAAIC,MAAJ,CAAW;AACrCC,UAAQ,sBAAIC,GAAJ;AAD6B,CAAX,CAA5B;;;wEAIgB,iBAAqCC,MAArC,EAA6CC,KAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAER,oDAAqC,EAAED,cAAF,EAAUC,YAAV;;AAE3C;;AAFM,aAFQ;;AAAA;AAMd,qCACE,iBAAEC,QAAF,CAAWF,MAAX,KAAsB,iBAAEG,UAAF,CAAaH,OAAOI,OAApB,CADxB,gHAIcJ,MAJd,qBAKWC,KALX;;AASMI,2BAfQ,GAeU,gCAASL,OAAOI,OAAP,EAAT,EAA2B;AACjDE,gCAAkB,IAD+B;AAEjDC,+BAAiBX;AAFgC,aAA3B,CAfV;;AAAA,gBAoBTS,gBAAgBG,KApBP;AAAA;AAAA;AAAA;;AAAA,6CAqBLR,MArBK;;AAAA;;AAwBdS,oBAAQC,GAAR;AACAL,4BAAgBG,KAAhB,CAAsBG,OAAtB,CAA8BC,OAA9B,CAAsC,UAACC,GAAD,EAAMC,KAAN,EAAgB;AACpDL,sBAAQC,GAAR,QAAgBI,QAAQ,CAAxB;AACAL,sBAAQC,GAAR,CAAYG,IAAIE,IAAhB;AACAN,sBAAQC,GAAR,CAAYG,IAAIG,IAAhB,OAA2BH,IAAII,OAA/B;AACAR,sBAAQC,GAAR;AACD,aALD;;AAOAD,oBAAQC,GAAR;;AAhCc,6CAsCPQ,QAAQC,IAAR,CAAa,CAAb,CAtCO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;WAAeC,qB;;;;SAAAA,qB","file":"webpack-modify-validate.js","sourcesContent":["import _ from \"lodash\"\nimport invariant from \"invariant\"\nimport validate, { Joi } from \"webpack-validator\"\nimport stripIndent from \"common-tags/lib/stripIndent\"\nimport apiRunnerNode from \"./api-runner-node\"\n\n// We whitelist special config keys that are not part of a standard Webpack v1\n// config but are in common usage. We should be able to completely remove this\n// once we're on Webpack v3.\n//\n// For info on whitelisting with webpack-validator see:\n// https://github.com/js-dxtools/webpack-validator#customizing\nconst validationWhitelist = Joi.object({\n  stylus: Joi.any(),\n})\n\nexport default (async function ValidateWebpackConfig(config, stage) {\n  // We don't care about the return as plugins just mutate the config directly.\n  await apiRunnerNode(`modifyWebpackConfig`, { config, stage })\n\n  // console.log(JSON.stringify(config, null, 4))\n\n  invariant(\n    _.isObject(config) && _.isFunction(config.resolve),\n    `\n    You must return an webpack-configurator instance when modifying the Webpack config.\n    Returned: ${config}\n    stage: ${stage}\n    `\n  )\n\n  const validationState = validate(config.resolve(), {\n    returnValidation: true,\n    schemaExtension: validationWhitelist,\n  })\n\n  if (!validationState.error) {\n    return config\n  }\n\n  console.log(`There were errors with your webpack config:`)\n  validationState.error.details.forEach((err, index) => {\n    console.log(`[${index + 1}]`)\n    console.log(err.path)\n    console.log(err.type, `,`, err.message)\n    console.log(`\\n`)\n  })\n\n  console.log(stripIndent`\n    Your Webpack config does not appear to be valid. This could be because of\n    something you added or a plugin. If you don't recognize the invalid keys listed\n    above try removing plugins and rebuilding to identify the culprit.\n  `)\n\n  return process.exit(1)\n})\n"]}